---
import { getCollection, render } from 'astro:content';
import BlogLayout from '../../layouts/BlogLayout.astro';
import { getFeatureFlag } from '../../lib/launchdarkly';

export const prerender = false;

const enableThoughts = await getFeatureFlag('enable-thoughts', false);
if (!enableThoughts) {
  return Astro.redirect('/');
}

const { slug } = Astro.params;
const posts = await getCollection('thoughts', ({ data }) => !data.draft);
const post = posts.find((p) => p.id === slug);

if (!post) {
  return Astro.redirect('/');
}

const { Content } = await render(post);
---

<BlogLayout title={post.data.title} date={post.data.date}>
  <Content />
</BlogLayout>
