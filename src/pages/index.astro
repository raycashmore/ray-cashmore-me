---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Container from '../components/Container.astro';
import ExternalLink from '../components/ExternalLink.astro';
---

<BaseLayout title="Ray Cashmore — Product Engineer">
  <Header />

  <main>
    <!-- Hero Section -->
    <section class="min-h-screen flex flex-col justify-center pt-20 relative overflow-hidden">
      <canvas id="dot-grid" class="absolute inset-0 w-full h-full pointer-events-none"></canvas>
      <Container class="relative z-10">
        <h1 class="text-5xl md:text-7xl lg:text-8xl font-semibold tracking-tight leading-none">
          Ray Cashmore
        </h1>
        <p class="mt-4 text-xl md:text-2xl text-muted">
          Product Engineer
        </p>
      </Container>
    </section>

    <script>
      const canvas = document.getElementById('dot-grid') as HTMLCanvasElement;
      const ctx = canvas.getContext('2d')!;

      const DOT_SPACING = 24;
      const DOT_RADIUS = 1;
      const BASE_OPACITY = 0.03;
      const WAVE_OPACITY = 0.25;

      let dots: { x: number; y: number; phase: number }[] = [];
      let animationId: number;

      function isDark() {
        return document.documentElement.classList.contains('dark');
      }

      function resize() {
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        createDots(rect.width, rect.height);
      }

      function createDots(width: number, height: number) {
        dots = [];
        const cols = Math.ceil(width / DOT_SPACING) + 1;
        const rows = Math.ceil(height / DOT_SPACING) + 1;

        for (let row = 0; row < rows; row++) {
          for (let col = 0; col < cols; col++) {
            dots.push({
              x: col * DOT_SPACING,
              y: row * DOT_SPACING,
              phase: Math.random() * 0.5
            });
          }
        }
      }

      function draw(time: number) {
        const rect = canvas.getBoundingClientRect();
        ctx.clearRect(0, 0, rect.width, rect.height);

        const dark = isDark();
        const baseColor = dark ? '255, 255, 255' : '0, 0, 0';

        dots.forEach(dot => {
          // Diagonal wave: combine x and y position
          const diagonal = (dot.x + dot.y) / 300;

          // Multiple overlapping waves for organic feel
          const wave1 = Math.sin(time * 0.0008 + diagonal + dot.phase);
          const wave2 = Math.sin(time * 0.0006 - diagonal * 0.7 + dot.phase * 1.3);
          const wave3 = Math.sin(time * 0.001 + diagonal * 0.5 + dot.phase * 0.8);

          const combined = (wave1 + wave2 + wave3) / 3;
          const opacity = BASE_OPACITY + (combined * 0.5 + 0.5) * WAVE_OPACITY;

          ctx.beginPath();
          ctx.arc(dot.x, dot.y, DOT_RADIUS, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(${baseColor}, ${opacity})`;
          ctx.fill();
        });

        animationId = requestAnimationFrame(draw);
      }

      resize();
      window.addEventListener('resize', resize);
      animationId = requestAnimationFrame(draw);

      // Watch for theme changes
      const observer = new MutationObserver(() => {
        // Theme changed, animation will pick up new colors on next frame
      });
      observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
    </script>

    <!-- Below the fold -->
    <section class="py-24 border-t border-border">
      <Container>
        <div class="grid md:grid-cols-2 gap-16 md:gap-24">
          <!-- Thoughts -->
          <div>
            <h2 class="text-xs font-medium text-muted uppercase tracking-widest mb-8">
              Thoughts
            </h2>
            <a href="/thoughts" class="text-lg md:text-xl hover:opacity-60">
              View all writing →
            </a>
          </div>

          <!-- Links -->
          <div>
            <h2 class="text-xs font-medium text-muted uppercase tracking-widest mb-8">
              Links
            </h2>
            <div class="space-y-4">
              <div>
                <a href="/cv" class="text-lg md:text-xl hover:opacity-60">
                  Curriculum Vitae →
                </a>
              </div>
              <div>
                <ExternalLink href="https://linkedin.com/in/raycashmore" label="LinkedIn" />
              </div>
              <div>
                <ExternalLink href="https://github.com/raycashmore" label="GitHub" />
              </div>
            </div>
          </div>
        </div>
      </Container>
    </section>
  </main>
</BaseLayout>
