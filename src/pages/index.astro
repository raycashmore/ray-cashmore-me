---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import SectionIndex from '../components/SectionIndex.astro';
import Section from '../components/Section.astro';
import BlogCard from '../components/BlogCard.astro';
import ExternalLink from '../components/ExternalLink.astro';

const posts = await getCollection('thoughts', ({ data }) => !data.draft);
const sortedPosts = posts
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);

const sections = [
  { id: 'hero', number: '01' },
  { id: 'about', number: '02' },
  { id: 'experience', number: '03' },
  { id: 'connect', number: '04' },
];
---

<BaseLayout title="Ray Cashmore — Product Engineer">
  <SectionIndex sections={sections} />

  <main>
    <!-- Section 01: Hero -->
    <section id="hero" class="dark min-h-screen flex flex-col justify-center relative overflow-hidden bg-[rgb(0,0,0)] text-[rgb(255,255,255)]">
      <canvas id="dot-grid" class="absolute inset-0 w-full h-full pointer-events-none"></canvas>
      <div class="swiss-grid relative z-10">
        <div class="col-span-full lg:col-span-4">
          <h1 class="type-hero-name">
            <span class="block">Ray</span>
            <span class="block">Cashmore</span>
          </h1>
          <p class="type-hero-tagline text-muted mt-12">
            <span class="block">Product</span>
            <span class="block">Engineer</span>
          </p>
        </div>
      </div>
    </section>

    <script>
      const canvas = document.getElementById('dot-grid') as HTMLCanvasElement;
      const ctx = canvas.getContext('2d')!;

      const DOT_SPACING = 24;
      const DOT_RADIUS = 1;
      const BASE_OPACITY = 0.03;
      const WAVE_OPACITY = 0.25;

      let dots: { x: number; y: number; phase: number }[] = [];
      let animationId: number;

      function resize() {
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        createDots(rect.width, rect.height);
      }

      function createDots(width: number, height: number) {
        dots = [];
        const cols = Math.ceil(width / DOT_SPACING) + 1;
        const rows = Math.ceil(height / DOT_SPACING) + 1;

        for (let row = 0; row < rows; row++) {
          for (let col = 0; col < cols; col++) {
            dots.push({
              x: col * DOT_SPACING,
              y: row * DOT_SPACING,
              phase: Math.random() * 0.5
            });
          }
        }
      }

      function draw(time: number) {
        const rect = canvas.getBoundingClientRect();
        ctx.clearRect(0, 0, rect.width, rect.height);

        // Hero section is always dark, so dots are always white
        const baseColor = '255, 255, 255';

        dots.forEach(dot => {
          const diagonal = (dot.x + dot.y) / 300;
          const wave1 = Math.sin(time * 0.0008 + diagonal + dot.phase);
          const wave2 = Math.sin(time * 0.0006 - diagonal * 0.7 + dot.phase * 1.3);
          const wave3 = Math.sin(time * 0.001 + diagonal * 0.5 + dot.phase * 0.8);

          const combined = (wave1 + wave2 + wave3) / 3;
          const opacity = BASE_OPACITY + (combined * 0.5 + 0.5) * WAVE_OPACITY;

          ctx.beginPath();
          ctx.arc(dot.x, dot.y, DOT_RADIUS, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(${baseColor}, ${opacity})`;
          ctx.fill();
        });

        animationId = requestAnimationFrame(draw);
      }

      resize();
      window.addEventListener('resize', resize);
      animationId = requestAnimationFrame(draw);
    </script>

    <!-- Section 02: About -->
    <Section id="about" number="02" class="border-t border-border">
      <p class="text-xl md:text-2xl leading-relaxed text-muted max-w-3xl">
        I build products that matter. With a focus on craft and user experience,
        I bridge the gap between design and engineering to create software that
        feels intentional and refined.
      </p>
    </Section>

    <!-- Section 03: Experience -->
    <Section id="experience" number="03" class="border-t border-border">
      <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-6 mb-16">
        <h2 class="type-section-title">Experience</h2>
        <a
          href="/ray-cashmore-cv.pdf"
          download
          class="inline-flex items-center gap-2 px-5 py-2.5 border border-foreground hover:bg-foreground hover:text-background transition-colors text-sm font-medium"
        >
          Download CV
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" />
          </svg>
        </a>
      </div>

      <!-- Experience Entries -->
      <div class="space-y-12 mb-20">
        <article class="grid md:grid-cols-4 gap-4 pb-12 border-b border-border">
          <div class="text-sm text-muted">Jul 2024 — Present</div>
          <div class="md:col-span-3">
            <h3 class="font-medium text-lg">Solutions Engineer</h3>
            <p class="text-muted mt-1">HERE (OpenFin)</p>
            <p class="mt-4 text-muted leading-relaxed">
              Growing the Asia-Pac region by forging technical pre and post-sales relationships. Collaborating with sales, engineering, product, and customer success teams to ensure successful implementations of the HERE Enterprise Browser. On-site consulting and hands-on engineering for a forthcoming, groundbreaking desktop platform at a major Australian institution.
            </p>
          </div>
        </article>

        <article class="grid md:grid-cols-4 gap-4 pb-12 border-b border-border">
          <div class="text-sm text-muted">Jan 2024 — Jul 2024</div>
          <div class="md:col-span-3">
            <h3 class="font-medium text-lg">Senior Software Engineer</h3>
            <p class="text-muted mt-1">Leonardo.Ai</p>
            <p class="mt-4 text-muted leading-relaxed">
              Software engineering and thought leadership at Australia's leading hyper-growth AI startup. Led the build of the flagship Image Generation v2 interface and contributed to key features like the Universal Upscaler during a pivotal growth phase. Improved delivery cadence, contributed to extensive hiring, and coached the team on scale-up delivery best practices.
            </p>
          </div>
        </article>

        <article class="grid md:grid-cols-4 gap-4 pb-12 border-b border-border">
          <div class="text-sm text-muted">Jan 2020 — Sep 2023</div>
          <div class="md:col-span-3">
            <h3 class="font-medium text-lg">Head of UI / UX</h3>
            <p class="text-muted mt-1">Yieldbroker</p>
            <p class="mt-4 text-muted leading-relaxed">
              Owned discovery and delivery of a high-performance financial trading platform, combining hands-on software engineering, UX design, and people management. Led chapter for all UI engineers through hiring, mentoring, and coaching. Worked closely with the CTO on organisational design. Established and led UX design practice with rapid prototypes, high-fidelity designs, and design systems in Figma.
            </p>
          </div>
        </article>

        <article class="grid md:grid-cols-4 gap-4">
          <div class="text-sm text-muted">Mar 2010 — Dec 2019</div>
          <div class="md:col-span-3">
            <h3 class="font-medium text-lg">Consultant Software Engineer</h3>
            <p class="text-muted mt-1">Lab49</p>
            <p class="mt-4 text-muted leading-relaxed">
              Go-to specialist for high-performance financial trading UIs across major institutions. Worked on commodities trading at Commonwealth Bank, leading the multi-year build of a new metals trading platform. Developed rich UIs for foreign exchange trading at NAB, fixed income at UBS, and contributed to the Matrix platform at Morgan Stanley. Expertise in streaming data, data grids, visualisations, and compliance-heavy environments.
            </p>
          </div>
        </article>
      </div>

      <!-- Education -->
      <div class="mb-20">
        <h3 class="type-label text-muted mb-10">Education</h3>
        <article class="grid md:grid-cols-4 gap-4 pb-12 border-b border-border">
          <div class="text-sm text-muted"></div>
          <div class="md:col-span-3">
            <h4 class="font-medium text-lg">Bachelor of Information Technology</h4>
            <p class="text-muted mt-1">University of Canberra</p>
            <p class="text-muted text-sm mt-1">Minor: Marketing</p>
          </div>
        </article>
        <article class="grid md:grid-cols-4 gap-4">
          <div class="text-sm text-muted"></div>
          <div class="md:col-span-3">
            <h4 class="font-medium text-lg">Senior Secondary Certificate</h4>
            <p class="text-muted mt-1">Marist College</p>
          </div>
        </article>
      </div>

      <!-- Skills -->
      <div>
        <h3 class="type-label text-muted mb-10">Skills</h3>

        <!-- Front-end -->
        <div class="mb-12">
          <h4 class="text-sm font-medium text-foreground mb-4">Front-end</h4>
          <div class="flex flex-wrap gap-3">
            <span class="px-4 py-2 border border-border text-sm">TypeScript</span>
            <span class="px-4 py-2 border border-border text-sm">React</span>
            <span class="px-4 py-2 border border-border text-sm">Next.js</span>
            <span class="px-4 py-2 border border-border text-sm">TanStack</span>
            <span class="px-4 py-2 border border-border text-sm">XState</span>
            <span class="px-4 py-2 border border-border text-sm">Angular</span>
            <span class="px-4 py-2 border border-border text-sm">RxJS</span>
            <span class="px-4 py-2 border border-border text-sm">Storybook</span>
            <span class="px-4 py-2 border border-border text-sm">SvelteKit</span>
            <span class="px-4 py-2 border border-border text-sm">Tailwind</span>
          </div>
        </div>

        <!-- Back-end -->
        <div class="mb-12">
          <h4 class="text-sm font-medium text-foreground mb-4">Back-end</h4>
          <div class="flex flex-wrap gap-3">
            <span class="px-4 py-2 border border-border text-sm">Node</span>
            <span class="px-4 py-2 border border-border text-sm">tRPC</span>
            <span class="px-4 py-2 border border-border text-sm">Drizzle</span>
            <span class="px-4 py-2 border border-border text-sm">REST</span>
            <span class="px-4 py-2 border border-border text-sm">NestJS</span>
            <span class="px-4 py-2 border border-border text-sm">GraphQL</span>
            <span class="px-4 py-2 border border-border text-sm">Postgres</span>
            <span class="px-4 py-2 border border-border text-sm">PayloadCMS</span>
          </div>
        </div>

        <!-- Mobile -->
        <div class="mb-12">
          <h4 class="text-sm font-medium text-foreground mb-4">Mobile</h4>
          <div class="flex flex-wrap gap-3">
            <span class="px-4 py-2 border border-border text-sm">React Native</span>
            <span class="px-4 py-2 border border-border text-sm">Expo</span>
          </div>
        </div>

        <!-- Testing & Cloud -->
        <div class="mb-12">
          <h4 class="text-sm font-medium text-foreground mb-4">Testing & Cloud</h4>
          <div class="flex flex-wrap gap-3">
            <span class="px-4 py-2 border border-border text-sm">Cypress</span>
            <span class="px-4 py-2 border border-border text-sm">Puppeteer</span>
            <span class="px-4 py-2 border border-border text-sm">Cucumber</span>
            <span class="px-4 py-2 border border-border text-sm">Playwright</span>
            <span class="px-4 py-2 border border-border text-sm">AWS</span>
            <span class="px-4 py-2 border border-border text-sm">Vercel</span>
            <span class="px-4 py-2 border border-border text-sm">Clerk</span>
            <span class="px-4 py-2 border border-border text-sm">Railway</span>
            <span class="px-4 py-2 border border-border text-sm">Convex</span>
          </div>
        </div>

        <!-- AI & Developer Tools -->
        <div class="mb-12">
          <h4 class="text-sm font-medium text-foreground mb-4">AI & Developer Tools</h4>
          <div class="flex flex-wrap gap-3">
            <span class="px-4 py-2 border border-border text-sm">MCP</span>
            <span class="px-4 py-2 border border-border text-sm">OpenAI API</span>
            <span class="px-4 py-2 border border-border text-sm">Ollama</span>
            <span class="px-4 py-2 border border-border text-sm">Claude Code</span>
            <span class="px-4 py-2 border border-border text-sm">Gemini CLI</span>
            <span class="px-4 py-2 border border-border text-sm">V0</span>
            <span class="px-4 py-2 border border-border text-sm">Bolt</span>
            <span class="px-4 py-2 border border-border text-sm">Lovable</span>
            <span class="px-4 py-2 border border-border text-sm">n8n</span>
          </div>
        </div>

        <!-- Engineering Management -->
        <div class="mb-12">
          <h4 class="text-sm font-medium text-foreground mb-4">Engineering Management</h4>
          <div class="flex flex-wrap gap-3">
            <span class="px-4 py-2 border border-border text-sm">Hiring</span>
            <span class="px-4 py-2 border border-border text-sm">Mentoring</span>
            <span class="px-4 py-2 border border-border text-sm">Code reviews</span>
            <span class="px-4 py-2 border border-border text-sm">DORA metrics</span>
            <span class="px-4 py-2 border border-border text-sm">Team Topologies</span>
            <span class="px-4 py-2 border border-border text-sm">Flow metrics</span>
            <span class="px-4 py-2 border border-border text-sm">Continuous delivery</span>
            <span class="px-4 py-2 border border-border text-sm">Scrum</span>
            <span class="px-4 py-2 border border-border text-sm">Lean/Kanban</span>
          </div>
        </div>

        <!-- User Experience Design -->
        <div class="mb-12">
          <h4 class="text-sm font-medium text-foreground mb-4">User Experience Design</h4>
          <div class="flex flex-wrap gap-3">
            <span class="px-4 py-2 border border-border text-sm">Prototyping</span>
            <span class="px-4 py-2 border border-border text-sm">Journey mapping</span>
            <span class="px-4 py-2 border border-border text-sm">Personas</span>
            <span class="px-4 py-2 border border-border text-sm">One-pagers</span>
            <span class="px-4 py-2 border border-border text-sm">Interaction design</span>
            <span class="px-4 py-2 border border-border text-sm">Story mapping</span>
            <span class="px-4 py-2 border border-border text-sm">Design systems</span>
            <span class="px-4 py-2 border border-border text-sm">Figma</span>
            <span class="px-4 py-2 border border-border text-sm">Sketch</span>
            <span class="px-4 py-2 border border-border text-sm">Zeplin</span>
            <span class="px-4 py-2 border border-border text-sm">Axure</span>
          </div>
        </div>

        <!-- Product Management -->
        <div class="mb-12">
          <h4 class="text-sm font-medium text-foreground mb-4">Product Management</h4>
          <div class="flex flex-wrap gap-3">
            <span class="px-4 py-2 border border-border text-sm">Product roadmaps</span>
            <span class="px-4 py-2 border border-border text-sm">Requirements gathering</span>
            <span class="px-4 py-2 border border-border text-sm">OKRs</span>
            <span class="px-4 py-2 border border-border text-sm">Stakeholder collaboration</span>
            <span class="px-4 py-2 border border-border text-sm">Pre-sales consulting</span>
          </div>
        </div>

        <!-- Domain Knowledge -->
        <div>
          <h4 class="text-sm font-medium text-foreground mb-4">Domain Knowledge</h4>
          <div class="flex flex-wrap gap-3">
            <span class="px-4 py-2 border border-border text-sm">Foreign exchange</span>
            <span class="px-4 py-2 border border-border text-sm">Fixed income</span>
            <span class="px-4 py-2 border border-border text-sm">Commodities</span>
            <span class="px-4 py-2 border border-border text-sm">Regulation</span>
            <span class="px-4 py-2 border border-border text-sm">Image generation</span>
            <span class="px-4 py-2 border border-border text-sm">Developer productivity</span>
          </div>
        </div>
      </div>
    </Section>

    <!-- Section 04: Connect -->
    <Section id="connect" number="04" class="border-t border-border">
      <div class="grid md:grid-cols-2 gap-16 md:gap-24">
        <!-- Thoughts -->
        <div>
          <h2 class="type-label text-muted mb-10">Thoughts</h2>
          {sortedPosts.length > 0 ? (
            <div class="space-y-8 mb-8">
              {sortedPosts.map((post) => (
                <BlogCard
                  title={post.data.title}
                  date={post.data.date}
                  slug={post.id}
                  excerpt={post.data.excerpt}
                />
              ))}
            </div>
          ) : (
            <p class="text-muted mb-8">No posts yet.</p>
          )}
          <a href="/thoughts" class="text-lg hover:opacity-60 inline-flex items-center gap-2">
            View all writing
            <span aria-hidden="true">→</span>
          </a>
        </div>

        <!-- Links -->
        <div>
          <h2 class="type-label text-muted mb-10">Links</h2>
          <div class="space-y-4">
            <div>
              <ExternalLink href="https://linkedin.com/in/raycashmore" label="LinkedIn" />
            </div>
            <div>
              <ExternalLink href="https://github.com/raycashmore" label="GitHub" />
            </div>
          </div>
        </div>
      </div>
    </Section>
  </main>
</BaseLayout>
